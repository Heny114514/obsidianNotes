$$\newcommand{\lcm}{\text{lcm}}$$
# 数论与密码学

## 群论初步

### Group 群

元素集合$G$与二元运算$\huge\cdot$构成群$\{G,\cdot\}$，如果满足：
- **封闭性**：若$a\in G$且$b\in G$，则$a\cdot b\in G$
- **结合律**：$a\cdot b\cdot c=a\cdot(b\cdot c)$
- **单位元**：存在单位元$e\in G$，使得$G$中任意元素满足$a\cdot e=e\cdot a=a$
- **逆元**：对$G$中任意元素$a$，存在$a'\in G$，满足$a\cdot a'=a'\cdot a=e$

>在群的基础定义中，不需要满足交换律

一个群$G$被称为**交换群**（**阿贝尔群**），如果满足：
- **交换律**：$a\cdot b=b\cdot a$

对群$G$中的指数运算定义如下：
- $a^0=e$
- $a^n=a^{n-1}\cdot a$
- $a^{-n}=(a^{-1})^n$，其中$a^{-1}$为$a$的逆元

一个群$G$被称为**循环群**，如果满足：
- 存在**生成元**$g$，使得$G$中任何元素都能表示为$g^k(k\in\mathbb{Z})$

>无论是有限群还是无限群，循环群总是**交换群**

### Rings 环

元素集合$R$与两个二元运算加法（$+$）和乘法（$\times$）构成环$\{R,+,\times\}$，如果满足：
- $\{R,+\}$是一个**交换群**，单位元为$0$，$a$的逆元为$-a$
- **乘法封闭性**：若$a\in R$且$b\in R$，则$a\times b\in R$
- **乘法结合律**：$a\times b\times c=a\times (b\times c)$
- **乘法分配律**：$a\times(b+c)=a\times b+a\times c,(a+b)\times c=a\times c+b\times c$

>在环的基础定义中，不需要满足**乘法交换律**、不要求存在**乘法单位元**、不要求存在**乘法逆元**，但需要满足**加法交换律**
>$a\times b$可简写为$ab$

一个环$R$被称为**交换环**，如果满足：
- **乘法交换律**：$a\times b=b\times a$

一个环$R$被称为**整环**，如果满足：
- $R$是一个**交换环**
- **乘法单位元**：存在元素$1\in R$，使得$R$中任意元素都满足$1\times a=a\times 1=a$
- **无零因子**：若$ab=0$，则$a=0$或$b=0$

### Fields 域

一个环$\{F,+,\times\}$被称为域，如果满足：
- $F$是一个**整环**
- **乘法逆元**：对$F$中任意元素$a$，存在$a^{-1}\in F$，满足$a\times a^{-1}=a^{-1}\times a=1$

对域$F$中的除法定义如下：
- $a/b=a(b^{-1})$

>由此，一个域F对加、减、乘、除运算封闭

## 素数

### 良序原理
**公理** 非空的自然数集的子集存在最小元
### 算数基本定理
**定理** 每一个大于$1$的整数都可以唯一的表示为素数的积
$$\huge a=\prod_{i=1}^{\infty}p_i^{\alpha_i}$$

### 最大公约数
**定义** 能够同时整除不全为零的$a$和$b$的最大整数$d$，记作$\gcd(a,b)$
>$\gcd(-24,-36)=12,\gcd(-17,22)=1$

### 最小公倍数
**定义** 能够同时被正整数$a$和$b$整除的最小正整数，记作$\lcm(a,b)$
**定理** 若$a,b$为正整数，则$\gcd(a,b)\cdot \lcm(a,b)=ab$

### 贝祖定理

**定理** 若$a,b$是正整数，则存在整数$s,t$使得
$$\huge \gcd(a,b)=sa+tb$$
>该定理可推广至$a,b$为任意整数且不全为零，则$\gcd(a,b)$是$a,b$的整系数线性组合中的最小正元

**推论** 若$d|a$且$d|b$，则$d|\gcd(a,b)$

**定义** 正整数$a,b$的贝祖系数为$s,t$，如果：$sa+tb=\gcd(a,b)$

### 素数测试

**定理** 若$a$是合数，则$a$必有小于或等于$\sqrt{a}$的因子

**推论** 若$a$是合数，则$a$必有小于或等于$\sqrt{a}$的素因子

#### 试除法
依次讲$\leq\sqrt{a}$的素数除$a$来判断$a$是否为素数
>时间复杂度：$O(2^{d/2})$，$d$为输入数据的二进制位数

#### 埃拉托斯特尼筛法
```cpp
#include<bits/stdc++.h>
using namespace std;
#define N 100
bool prime[N+1];
int main(){
	memset(prime,true,sizeof(prime));
	for(int i=2;i<=N;i++){
		if(!prime[i]) continue;
		for(int j=i+i;j<=N;j+=i) prime[j]=false;
	}
	for(int i=2;i<=N;i++) 
		if(prime[i]) cout<<i<<' ';
	return 0;
}
```

复杂度比较：在找出$\leq n$的所有素数的条件下
- 筛法复杂度：$O(2^d\log{d})$或$O(n\log{\log{n}})$
- 试除法复杂度：$O(2^d\cdot 2^{d/2})$或$O(n\cdot n^{1/2})$

### 无穷素数
**定理** 素数的个数是无限的

**定义** 梅森素数是形如$2^p-1$的素数，其中$p$为素数

### 素数定理
**定理** 记$\pi(x)$表示不超过$x$的素数个数，则有
$$\huge \lim_{n\rightarrow\infty}{\dfrac{\pi(x)\ln{x}}{x}}=1$$

### 威尔逊定理
**定理** $p$是素数当且仅当$(p-1)!\equiv{-1}\pmod p$
## 互素
**定义** $a,b$互素如果$gcd(a,b)=1$
**定义** $a_1,a_2,...,a_n$两两互素如果$a_i,a_j$对任意$1\leq i<j\leq n$都互素

### 欧几里得算法
```cpp
int gcd(int a,int b){
	if(b==0) return a;
	return gcd(b,a%b);
}
```
### 扩展欧几里得算法 求贝祖系数
```cpp
void exgcd(int a,int b,int &d,int &x,int &y){
    if(b==0){
        d=a;
        x=1;
        y=0;
        return;
    }
    exgcd(b,a%b,d,y,x);
    y -= (a/b)*x;
}
```
满足$xa+yb=d=\gcd(a,b)$

>可用于求解模$m$下的逆：
>若$gcd(a,m)=1$，则有$xa+ym=1$，即
>$$\huge xa\equiv1\pmod{n}$$

### 同余除法
**定理** 若$ac\equiv bc\pmod m$，则有
$$\huge a\equiv b\pmod{\dfrac{m}{\gcd(m,c)}}$$
**推论** 若$m,c$互素，则有
$$\huge a\equiv b\pmod m$$
## 同余方程
**定义** 若$aa^{-1}\equiv1\pmod m$，则称$a^{-1}$为$a$模$m$的逆
**定理** 若$a,m$互素且$m>1$，则$a$在模$m$下有唯一逆元

### 中国剩余定理

**定理** 设$m_1,m_2,...,m_n$两两互素且均大于一，$a_1,a_2,...,a_n$是任意整数，则方程组
$$\huge\begin{cases}
x\equiv a_1\pmod{m_1}\\
x\equiv a_2\pmod{m_2}\\
\cdots\\
x\equiv a_n\pmod{m_n}

\end{cases}$$
在模$m=m_1m_2...m_n$的意义下有唯一解
$$\huge x\equiv a_1M_1M_1^{-1}+a_2M_2M_2^{-1}+\cdots+a_nM_nM_n^{-1}\pmod m$$
其中，$M_i=\frac{m}{m_i}$，$M_i^{-1}$是$M_i$在模$m_i$下的逆

### 回代法
**例** 求解同余方程$$\huge \begin{cases}
x\equiv2\pmod3\cdots\cdots(1)\\
x\equiv3\pmod5\cdots\cdots(2)\\
x\equiv2\pmod7\cdots\cdots(3)
\end{cases}$$
**解**
由$(1)$得
$$\huge x=3r+2$$
代入$(2)$得
$$\huge 3r+2\equiv3\pmod5$$
解得
$$\huge r\equiv2\pmod5$$
此即
$$\huge r=5s+2$$
回代得
$$\huge x=15s+8$$
代入$(3)$得
$$\huge 15s+8\equiv2\pmod7$$
解得
$$\huge s\equiv1\pmod7$$
此即
$$\huge s=7t+1$$
回代得
$$\huge x=105t+23$$
即
$$\huge x\equiv{23}\pmod{105}$$


## 欧拉函数与欧拉定理

### 欧拉函数

**定义** 欧拉函数$\varphi(n)$表示比$n$小且与$n$互质的数的个数
- 若$p$为素数，则$\varphi(p)=p-1$
- 若$a,b$互素，则$\varphi(ab)=\varphi(a)\varphi(b)$
- 若$a,b$不互素，则$\varphi(ab)=a\varphi(b)$，其中$a\leq b$
- 若$p$为素数，则$$\huge\varphi(p^n)=p^n-p^{n-1}=p^n\left(1-\dfrac{1}{p}\right)$$
- 对任意正整数$n$，若其质因数为$p_1,p_2,...,p_k$，则$$\huge\varphi(n)=n\left(1-\dfrac{1}{p_1}\right)\left(1-\dfrac{1}{p_2}\right)\cdots\left(1-\dfrac{1}{p_k}\right)$$
### 欧拉定理

**定理** 若$\gcd(a,n)=1$，则有
$$\huge a^{\varphi(n)}\equiv1\pmod n$$
**推论（幂循环）** 若$\gcd(a,n)=1$，则有
$$\huge a^x\equiv a^{x\mod{\varphi(n)}}\pmod n$$
**费马小定理** 若$p$为素数且$a$不被$p$整除，则
$$\huge a^{p-1}\equiv1\pmod p$$
### 伪素数
**定义** $b$是正整数，$n$是一个合数，$n$被称为基数$b$的伪素数，如果：
$$\huge b^{n-1}\equiv1\pmod n$$
### 原根
**定义** 整数$r$是素数$p$的原根，如果：
- $r\in\mathbb{Z}_p$
- $\mathbb{Z}_p$中每一个非零元素都是$r$的幂

>每个素数都存在一个原根

### 离散对数
**定义** 设$r$为素数$p$的一个原根，$1\leq a\leq p-1$。若$r^e\mod{p}=a$，且$1\leq e\leq p-1$，则称$e$为模$p$以$r$为底$a$的离散对数，记作$e=\log_r{a}$

## 密码学

### 密码系统
**定义** 一个密码系统是一个五元组$(P,C,K,E,D)$，其中：
- $P$是明文字符串的集合
- $C$是密文字符串的集合
- $K$是密钥空间
- $E$是加密函数的集合
- $D$是解密函数的集合

使用密钥$k$加密的函数记作$E_k$，解密函数记作$D_k$

密码系统的正确性即$D_k(E_k(p))=p$对所有明文成立
### 仿射密码
使用如下加密函数$$\huge f(p)=(ap+b)\mod{m}$$
>当且仅当$\gcd(a,m)=1$时，$f$是双射

解密函数
$$\huge f^{-1}(c)=a^{-1}(c-b)\mod{m}$$

### 块密码
**置换密码** 密钥$\sigma$定义为集合$\{1,2,...,m\}$上的置换。加密时将密文分为大小为$m$的块，并添加额外的字母补全，对每个块应用$\sigma$置换。

### RSA密码系统

设$p,q$是两个不相等的大素数，$n=pq$，$w$是一个与$\varphi(n)=(p-1)(n-1)$互素的数，$d$为$w$模$\varphi(n)$的逆，$m$是明文且$m<n$

- **加密密钥**：$(n,w)$
- **解密密钥**：$(n,d)$
- **保密数据**：$p,q,\varphi(n),d$
- **加密函数**：$$\huge E_{(n,w)}(m)=m^w\mod n$$
- **解密函数**：$$\huge D_{(n,d)}(c)=c^d\mod n$$
### Diffie-Hellman密钥交换协议
Alice和Bob希望共享一个密钥
- 双方选择一个素数$p$及其原根$a$
- Alice选择一个整数$k_1$并发送$a^{k_1}\mod p$
- Bob选择一个整数$k_2$并发送$a^{k_2}\mod p$
- 两人分别计算得到共享密钥$$\huge k=(a^{k_1})^{k_2}\mod p=(a^{k_2})^{k_1}\mod p$$

### 数字签名
Bob为确保收到的消息来自Alice
- Alice使用解密函数加密，发送$c=D_{(n,d)}(m)$
- Bob使用加密函数解密，得到$m'=E_{(n,w)}(c)$
若$m'=m$，则可以确信消息来自$Alice$

### 同态加密
**定义** **全同态加密**指对密文经行操作等价于对明文经行操作，即满足性质$$\huge E((m_1+m_2)\times m_3)=(E(m_1)+E(m_2))\times E(m_3)$$
**部分同态加密**即只对某些运算同态
- **加法同态**：$$\huge E(m_1+m_2)=E(m_1)+E(m_2)$$
- **乘法同态**：$$\huge E(m_1\times m_2)=E(m_1)\times E(m_2)$$

>RSA密码系统是乘法同态，非加法同态

### Schnorr ZKP零知识证明协议
证明者向验证者证明其知晓离散对数，但不透露具体值：
选取一个素数$p$及其原根$g$，证明者有私钥$x<p$，公钥$y=g^x\mod{p}$，重复$n$轮以下操作：
- 证明者随机选取一个小于$p$的整数$r$，发送$a=g^r\mod p$
- 验证者发送一个随机值$(e=0或1)$
- 证明者发送$s=(r+ex)\mod{(p-1)}$
- 验证者验证$g^s=ay^e\mod p$是否成立
>重复$n$轮下，若证明者不知道离散对数，则验证成功率为$\left(\frac{1}{2}\right)^n$

## 余数系统

### 定义
利用中国剩余定理，可以将一个大整数表示为元组
**定义** 大整数$x$在余数系统下可表示为$$\huge x=(x_1|x_2|\cdots|x_k)\text{RNS}(p_1|p_2|\cdots|p_k)$$
其中
$$\huge x_i=x\mod p_i$$且对任意$i,j$，有$p_i,p_j$互素


### 运算

$$\large x+y=((x_1+y_1)\mod p_1|(x_2+y_2)\mod p_2|\cdots(x_k+y_k)\mod p_k)$$
$$\large x\times y=((x_1\times y_1)\mod p_1|(x_2\times y_2)\mod p_2|\cdots(x_k\times y_k)\mod p_k)$$
# 组合数学基础

## 鸽巢原理

**定理** 将$k+1$个物体放入$k$个盒子中，则至少有一个盒子包含两个或更多物体

**广义鸽巢原理** 将$N$个物体放入$k$个盒子中，则至少有一个盒子包含至少$\lceil N/k\rceil$个物体

## 排列组合

**定义** 对于$n$个不同元素的集合，其$r$-排列的数量为
$$\huge P(n,r)=\dfrac{n!}{(n-r)!}$$
**定义** 对于$n$个不同元素的集合，其$r$-组合的数量为
$$\huge C(n,r)或\binom{n}{r}=\dfrac{n!}{r!(n-r)!}$$
### 组合证明
组合证明指使用以下方法之一来证明恒等式：
- **双计数证明**：使用计数论证来证明恒等式两边以不同的方式计算相同的对象
- **双射证明**：展示恒等式两边所计数的对象集合之间存在双射关系

#### 二项式定理
$$\huge (x+y)^n=\sum_{k=0}^{n}\binom{n}{k}x^{n-k}y^k$$
#### 帕斯卡恒等式
$$\huge \binom{n+1}{k}=\binom{n}{k}+\binom{n}{k-1}$$
## 广义排列组合

### 带有重复对象的排列组合

| 类型     | 是否允许重复 | 公式                   |
| ------ | ------ | -------------------- |
| $r$-排列 | 否      | $$P(n,r)$$           |
| $r$-组合 | 否      | $$\binom{n}{r}$$     |
| $r$-排列 | 是      | $$n^r$$              |
| $r$-组合 | 是      | $$\binom{n+r-1}{r}$$ |

### 带有不可区分对象的排列
**定理** $n$个对象分为$k$类，每类分别有$n_1,n_2,...,n_k$个对象，不同的排列数量是
$$\huge \dfrac{n!}{n_1!n_2!\cdots n_k!}$$
>这里的不可区分指的是同一类中的不可区分
### 将对象分配到盒子中


| $n$物体是否可区分 | $k$盒子是否可区分 | 公式                                  |
| ---------- | ---------- | ----------------------------------- |
| 是          | 是          | $$\dfrac{n!}{n_1!n_2!\cdots n_k!}$$ |
| 否          | 是          | $$\binom{n+k-1}{k}$$                |
| 是          | 否          | 无简单封闭公式                             |
| 否          | 否          | 无简单封闭公式                             |

>这里的区分指的是所有物体或盒子之间的区分

## 母函数

**定义** 对于序列$a_0,a_1,a_2,...$，函数
$$\huge G(x)=a_0+a_1x+a_2x^2+\cdots$$
称为序列的**母函数**
>母函数利用多项式乘法的过程来模拟**组合**

母函数是这样一种方法，对于对象$k$，其母函数的指数为所有可能的选取的个数，各项系数为该选取下对应的方法数。将所有对象的母函数乘起来，得到的描述所有对象做**组合**的状态空间。

**例** 有8个白球和5个黑球，要求选取偶数个白球和不少于两个黑球，有多少组合方式
**解**
白球的母函数为
$$\huge G_w(x)=1+x^2+x^4+x^6+x^8$$
黑球的母函数为
$$\huge G_b(x)=x^2+x^3+x^4+x^5+x^6$$
取乘积
$$\huge G=G_w(x)G_b(x)$$
其中$x^k$的系数即为$k$个球的组合的方法数

**例** 若上例中白球不可区分，则有多少组合方式
**解** 
白球母函数改写为
$$\huge G_w(x)=\binom{8}{0}+\binom{8}{2}x^2+\cdots+\binom{8}{8}x^8$$

### 整数拆分

多项式相乘时指数相加，利用指数来表征整数的组合

#### 无序拆分

**例** 整数$a_1,a_2,...,a_n$分别有$k_1,k_2,...,k_n$个，求整数$N$有几种拆分方式
**解**
整数$a_i$对应的母函数为
$$\huge G_i(x)=1+x^{a_i}+x^{2a_i}+\cdots+x^{k_ia_i}=\dfrac{1-x^{(k_i+1)a_i}}{1-x^{a_i}}$$
若$a_i$有无穷个，则
$$\huge G_i(x)=\dfrac{1}{1-x^{a_i}}$$

将所有母函数相乘
$$\huge G(x)=\prod_{i=1}^n{G_i(x)}$$
其中$x^N$的系数即为$N$的拆分方式数

#### 有序拆分

**例（定项拆分）** 将$N$有序拆分为$r$个非$0$部分
**解**
**方法1（隔板法）** 这相当于在$N$个球中插入$r-1$个隔板，结果为$\binom{N-1}{r-1}$
**方法2（母函数）**
每个部分的数对应的母函数为$$\huge G_i(x)=x+x^2+\cdots=\dfrac{x}{1-x}$$
相乘得
$$\huge G(x)=x^r(1-x)^{-r}=x^r\sum_{k=0}^{\infty}\binom{r+k-1}{r-1}x^k$$
令$k+r=N$，有
$$\huge G(x)=\sum_{N=r}^{\infty}\binom{N-1}{r-1}x^N$$

**例（不定项拆分）** 将$N$有序拆分的方法数
**解**
只需将$N$的$r$-拆分累加即可
$$\huge \sum_{r=1}^N\binom{N-1}{r-1}=\sum_{j=0}^{N-1}\binom{N-1}{j}=2^{N-1}$$
**例** 将$N$有序拆分为无限个整数$a_1,a_2,...,a_n$的和
**解**
母函数为
$$\huge G=1+(x^{a_1}+x^{a_2}+\cdots+x^{a_n})+(x^{a_1}+x^{a_2}+\cdots+x^{a_n})^2+\cdots$$
### 指数型母函数
**定义** 对于序列$a_0,a_1,a_2,...$，函数
$$\huge G_e(x)=a_0+\dfrac{a_1}{1!}x+\dfrac{a_2}{2!}x^2+\cdots$$
称为序列的**指数型母函数**
>用于解决从分为$k$类的对象中做$r$-**排列**的问题

**例** 现有$n$个元素$a_1,a_2,...,a_n$，分别重复$k_1,k_2,...,k_n$次，对其做$r$-排列
**解**
$a_i$对应的指数型母函数为
$$\huge G_{ei}(x)=1+\dfrac{x}{1!}+\dfrac{x^2}{2!}+\cdots+\dfrac{x^{k_1}}{k_1!}$$
若$a_i$有无穷个，则
$$\huge G_{ei}(x)=e^x$$
其$r$-排列的母函数为
$$\huge G_e(x)=\prod_{i=1}^nG_{ei}(x)$$
其中，$\dfrac{x^r}{r!}$对应的系数为$r$-排列的方法数


**例** 由$1,2,3,4,5$组成$n$位数，其中$2,4$出现偶数次
**解**
指数型母函数为
$$\huge\begin{align}
G_e(x)&=\left(1+\dfrac{x^2}{2!}+\dfrac{x^4}{4!}+\cdots\right)^2\left(1+\dfrac{x}{1!}+\dfrac{x^2}{2!}+\cdots\right)^3\\
&=\left(\dfrac{e^x+e^{-x}}{2}\right)^2e^{3x}\\
&=\dfrac{1}{4}(e^{5x}+2e^{3x}+e^x)\\
&=\sum_{n=0}^\infty\dfrac{1}{4}(5^n+2\cdot3^n+1)\dfrac{x^n}{n!}
\end{align}$$
即$n$位数有$a_n=\dfrac{1}{4}(5^n+2\cdot3^n+1)$种可能
